<!DOCTYPE html>
<html>
	<head>
	<meta charset="ISO-8859-1">
	<title>ER</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="dagre-d3.js"></script>
	
	<style>
		.link {
		    stroke: black;
		    fill: none;
		}
		
		.svg{
    display: block;
    margin: auto;
}
.link_continuous {
   fill: none;
    stroke: #007bff;
    stroke-width: 1.5px;
    stroke-dasharray: 20,10,5,5,5,10;
}
.link_dashed {
    fill: none;
    stroke: #007bff;
    stroke-width: 1.5px;
    stroke-dasharray: 20,10,5,5,5,10;
}
.link_dashed1
{fill: none;
  stroke: black;
  stroke-width: 1.5px;}
  
.ArrowHead{

viewbox: "0 0 10 10";
refX=8;
refY=5;
            markerUnits=strokeWidth
            markerWidth=8
            markerHeight=5
            orient=auto
            style="fill: white; stroke: black; stroke-width: 2px">
      <path d="M50 0 L50 100 M50 50 L25 0 M50 50 L75 0 M25 75 L75 75"


}
node rect,
.node circle,
.node ellipse,
.node polygon {
  stroke: #333;
  fill: #fff;
  stroke-width: 1.5px;
}

.edgePath path {
  stroke: #333;
  fill: #333;
  stroke-width: 1.5px;
}

.path {
  stroke: white;
  fill: black;
}
.top
{
 position:absolute;
 top:0px;
}

</style>
</head>
<body bgcolor="#E6E6FA">
<svg width=70 height=215>
  <defs>
    <marker id=circlearrow
            viewbox="0 0 10 10"
            refX=8
            refY=5
            markerUnits=strokeWidth
            markerWidth=8
            markerHeight=5
            orient=auto
            style="fill: #333">
      <path d="M0 50 L100 50 M25 25 L 25 75 M75 25 L75 75"/>
    </marker>
    <marker id=ArrowHead
            viewbox="0 0 10 10"
            refX=8
            refY=5
            markerUnits=strokeWidth
            markerWidth=8
            markerHeight=5
            orient=auto
            style="fill: white; stroke: black; stroke-width: 2px">
      <path d="M50 0 L50 100 M50 50 L25 0 M50 50 L75 0 M25 75 L75 75"/>
    </marker>
  </defs>
  <g transform="translate(20,20)"/>
  </svg>
<svg >
	<div id="erDiagram" class="top" style="text-align:top";"display: block";"margin: auto"></div>
	
	<!--<svg width="100px" height="100px">

		<path d="M0 50 L100 50 M50 50 L 0 25 M50 50 L0 75 M75 25 L75 75" stroke="red" fill="none"/></svg>
<svg width="100px" height="100px">
<path d="M0 50 L100 50 M25 25 L 25 75 M75 25 L75 75" stroke="red" fill="none"/>

</svg>-->
	
	<script>
    $(document).ready(function () {
	  var margin = {top: 20, right: 10, bottom: 20, left: 10};
	  var PointColors = ['lightsteelblue', 'lightgreen']
		//d3.json("erData.json", function(json) {
		var erData = [
{
"name":"employees",
"columns":[{"name": "employeeid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "integer", "primaryKey": "true", "size": 0}, {"name": "lastname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "20"}, {"name": "firstname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "10"}, {"name": "title", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "30"}, {"name": "titleofcourtesy", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "25"}, {"name": "birthdate", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "datetime", "primaryKey": "false", "size": 0}, {"name": "hiredate", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "datetime", "primaryKey": "false", "size": 0}, {"name": "address", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "60"}, {"name": "city", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "region", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "postalcode", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "10"}, {"name": "country", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "homephone", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "24"}, {"name": "extension", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "4"}, {"name": "photo", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "blob", "primaryKey": "false", "size": 0}, {"name": "notes", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "text", "primaryKey": "false", "size": 0}, {"name": "reportsto", "referencedColumnName": "No", "referencedTableName": "employees", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "false", "size": "108"}, {"name": "photopath", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "255"}, {"name": "salary", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "float", "primaryKey": "false", "size": 0}]
,"children":[
{
"name":"employeeterritories",
"columns":[{"name": "employeeid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "employeeid", "referencedColumnName": "No", "referencedTableName": "employees", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "territoryid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "territoryid", "referencedColumnName": "No", "referencedTableName": "territories", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "true", "size": "108"}]
,"children":[
{
"name":"territories",
"columns":[{"name": "territoryid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "varchar", "primaryKey": "true", "size": "20"}, {"name": "territorydescription", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "50"}, {"name": "regionid", "referencedColumnName": "No", "referencedTableName": "region", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "false", "size": "108"}]
,"children":[
{
"name":"region",
"columns":[{"name": "regionid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "integer", "primaryKey": "true", "size": 0}, {"name": "regiondescription", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "50"}]
}
]
}
]
}
,{
"name":"orders",
"columns":[{"name": "orderid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "integer", "primaryKey": "true", "size": 0}, {"name": "customerid", "referencedColumnName": "No", "referencedTableName": "customers", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "false", "size": "108"}, {"name": "employeeid", "referencedColumnName": "No", "referencedTableName": "employees", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "false", "size": "108"}, {"name": "orderdate", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "datetime", "primaryKey": "false", "size": 0}, {"name": "requireddate", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "datetime", "primaryKey": "false", "size": 0}, {"name": "shippeddate", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "datetime", "primaryKey": "false", "size": 0}, {"name": "shipvia", "referencedColumnName": "No", "referencedTableName": "shippers", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "false", "size": "108"}, {"name": "freight", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "decimal", "primaryKey": "false", "size": "10,4"}, {"name": "shipname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "40"}, {"name": "shipaddress", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "60"}, {"name": "shipcity", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "shipregion", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "shippostalcode", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "10"}, {"name": "shipcountry", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}]
,"children":[
{
"name":"orderdetails",
"columns":[{"name": "orderid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "orderid", "referencedColumnName": "No", "referencedTableName": "orders", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "productid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "productid", "referencedColumnName": "No", "referencedTableName": "products", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "unitprice", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "decimal", "primaryKey": "false", "size": "10,4"}, {"name": "quantity", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "smallint", "primaryKey": "false", "size": 0}, {"name": "discount", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "double", "primaryKey": "false", "size": 0}]
,"children":[
{
"name":"products",
"columns":[{"name": "productid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "integer", "primaryKey": "true", "size": 0}, {"name": "productname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "40"}, {"name": "supplierid", "referencedColumnName": "No", "referencedTableName": "suppliers", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "false", "size": "108"}, {"name": "categoryid", "referencedColumnName": "No", "referencedTableName": "categories", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "false", "size": "108"}, {"name": "quantityperunit", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "20"}, {"name": "unitprice", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "decimal", "primaryKey": "false", "size": "10,4"}, {"name": "unitsinstock", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "smallint", "primaryKey": "false", "size": 0}, {"name": "unitsonorder", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "smallint", "primaryKey": "false", "size": 0}, {"name": "reorderlevel", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "smallint", "primaryKey": "false", "size": 0}, {"name": "discontinued", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "bit", "primaryKey": "false", "size": 0}]
,"children":[
{
"name":"suppliers",
"columns":[{"name": "supplierid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "integer", "primaryKey": "true", "size": 0}, {"name": "companyname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "40"}, {"name": "contactname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "30"}, {"name": "contacttitle", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "30"}, {"name": "address", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "60"}, {"name": "city", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "region", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "postalcode", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "10"}, {"name": "country", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "phone", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "24"}, {"name": "fax", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "24"}, {"name": "homepage", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "text", "primaryKey": "false", "size": 0}]
}
,{
"name":"categories",
"columns":[{"name": "categoryid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "integer", "primaryKey": "true", "size": 0}, {"name": "categoryname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "description", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "text", "primaryKey": "false", "size": 0}, {"name": "picture", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "blob", "primaryKey": "false", "size": 0}]
}
]
}
]
}
,{
"name":"customers",
"columns":[{"name": "customerid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "varchar", "primaryKey": "true", "size": "5"}, {"name": "companyname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "40"}, {"name": "contactname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "30"}, {"name": "contacttitle", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "30"}, {"name": "address", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "60"}, {"name": "city", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "region", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "postalcode", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "10"}, {"name": "country", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "15"}, {"name": "phone", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "24"}, {"name": "fax", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "24"}]
,"children":[
{
"name":"customercustomerdemo",
"columns":[{"name": "customerid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "customerid", "referencedColumnName": "No", "referencedTableName": "customers", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "customertypeid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "varchar", "primaryKey": "true", "size": "108"}, {"name": "customertypeid", "referencedColumnName": "No", "referencedTableName": "customerdemographics", "constraintType": "FOREIGN KEY", "type": "varchar", "primaryKey": "true", "size": "108"}]
,"children":[
{
"name":"customerdemographics",
"columns":[{"name": "customertypeid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "varchar", "primaryKey": "true", "size": "10"}, {"name": "customerdesc", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "text", "primaryKey": "false", "size": 0}]
}
]
}
]
}
,{
"name":"shippers",
"columns":[{"name": "shipperid", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "PRIMARY KEY", "type": "integer", "primaryKey": "true", "size": 0}, {"name": "companyname", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "40"}, {"name": "phone", "referencedColumnName": "No", "referencedTableName": "No", "constraintType": "No", "type": "varchar", "primaryKey": "false", "size": "24"}]
}
]
}
]
}
]

        var w = 1800,
          h = 1900,
          i = 0,
          duration = 500,
          root;

        var tree = d3.layout.tree()
          .size([h, w - 160]);
		  

        var diagonal = d3.svg.diagonal()
            .source(function (d) {
                return {
                    "x": d.source.x + d.source.height/2 ,
                    "y": d.source.y +150
                };
            })
            .target(function (d) {
                return {
                    "x": d.target.x + d.target.height/2,
                    "y": d.target.y+100
                };
            })
            .projection(function (d) { return [d.x+15, d.y-30 ];
          });
		
		function pan(domNode, direction) {
        var speed = panSpeed;
        if (panTimer) {
            clearTimeout(panTimer);
            translateCoords = d3.transform(svgGroup.attr("transform"));
            if (direction == 'left' || direction == 'right') {
                translateX = direction == 'left' ? translateCoords.translate[0] + speed : translateCoords.translate[0] - speed;
                translateY = translateCoords.translate[1];
            } else if (direction == 'up' || direction == 'down') {
                translateX = translateCoords.translate[0];
                translateY = direction == 'up' ? translateCoords.translate[1] + speed : translateCoords.translate[1] - speed;
            }
            scaleX = translateCoords.scale[0];
            scaleY = translateCoords.scale[1];
            scale = zoomListener.scale();
            svgGroup.transition().attr("transform", "translate(" + translateX + "," + translateY + ")scale(" + scale + ")");
            d3.select(domNode).select('g.node').attr("transform", "translate(" + translateX + "," + translateY + ")");
            zoomListener.scale(zoomListener.scale());
            zoomListener.translate([translateX, translateY]);
            panTimer = setTimeout(function() {
                pan(domNode, speed, direction);
            }, 50);
        }
    }

    // Define the zoom function for the zoomable tree

   function zoom() {
        svgGroup.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
    }


    // define the zoomListener which calls the zoom function on the "zoom" event constrained within the scaleExtents
    var zoomListener = d3.behavior.zoom().scaleExtent([0.1, 3]).on("zoom", zoom);
		
        var vis = d3.select('#erDiagram').append("svg:svg")
          .attr("width", w)
          .attr("height", h)
         .attr("transform", "translate(0,0)")
		  .call(zoomListener);

		  var svgGroup = vis.append("g");	
        root = erData[0];
        root.x0 = h / 2;
        root.y0 = 0;
        update(root);

        function update(source) {
        	var nodes = tree.nodes(root).reverse();

            var node = svgGroup.selectAll("g.node")
              .data(nodes, function (d) {
                  return d.id || (d.id = ++i);
              });

            var nodeEnter = node.enter().append("g")
              .attr("class", "node")
              .attr("transform", function (d) {
                  return "translate(" + source.x0 + "," + source.y0 + ")";
              });

            nodeEnter.append("svg:rect")
              .attr("width", 195)
              .attr("height", 500)
      		  .attr('y', 0)
      		  .attr('rx', 5)
      		  .attr('ry', 5)
      		  .attr('stroke', 'black')
      		  .attr('stroke-width', '3px')
      		  .attr('fill', 'white')
              .attr("id", function (d) {
                  return d._children;
              })
              .style("fill", function (d) {
                  return d._children ? "white" : "white";
              })
			 // .on("click", click);
		.on("click", function(){
        PointColors = [PointColors[1], PointColors[0]]
        d3.select(this).style("fill", PointColors[0]);})
		.on({
      "mouseover": function(d) {
        d3.select(this).style("cursor", "pointer"); 
      },
      "mouseout": function(d) {
        d3.select(this).style("cursor", "default"); 
      }
    
	
	});
              
            nodeEnter.append("text")
              .attr("x", function (d) {
                  return d._children ? -8 : 8;
              })
              .attr("y", 3)
              .attr("dy", "0.68em")
              .text(function (d) {
                  return d.name;
              });

            wrap(d3.selectAll('text'), 195);

            nodeEnter.transition()
              .duration(duration)
              .attr("transform", function (d) {
                  return "translate(" + (d.x-50) + "," + (d.y+50) + ")";
              })
              .style("opacity", 1)
              .select("rect")

            .style("fill", "lightsteelblue");

            node.transition()
              .duration(duration)
              .attr("transform", function (d) {
                  return "translate(" + (d.x-50) + "," + (d.y+50) + ")";
              })
              .style("opacity", 1);


            node.exit().transition()
              .duration(duration)
              .attr("transform", function (d) {
                  return "translate(" + source.y + "," + source.x + ")";
              })
              .style("opacity", 1e-6)
              .remove();

            var link = svgGroup.selectAll("path.link")
			              .data(tree.links(nodes), function (d) {
                  return d.target.id;
              });
			  
            svgGroup.selectAll("path.link").attr()
			
            link.enter().insert("svg:path", "g")
              .attr("class",  function (d) { 
			  if(d.source == root)
			  {
			  return "link_dashed" ;
			  }
			  else
			  {
			 return "link_continuous" ;
			  }
			  	  
			  })
			  .attr("marker-mid","ArrowHead")
			  //return (d.source != root) ? "link_dashed" : "link_continuous" ; })
              .attr("d", function (d) {
                  var o = {
                      x: source.x0,
                      y: source.y0,
                      height: source.height
                  };
                  return diagonal({
                      source: o,
                      target: o
                  });
              })
			  
              .transition()
              .duration(duration)
              .attr("d", diagonal);
			 
			  
            link.transition()
              .duration(duration)
              .attr("d", diagonal);

            link.exit().transition()
              .duration(duration)
              .attr("d", function (d) {
                  var o = {
                      x: source.x,
                      y: source.y
                  };
                  return diagonal({
                      source: o,
                      target: o
                  });
              })
              .remove();
		
			  
            nodes.forEach(function (d) {
                d.x0 = d.x;
                d.y0 = d.y;
            });
        }
        
        function click(d) {
            if (d.children) {
                d._children = d.children;
                d.children = null;
            } else {
                d.children = d._children;
                d._children = null;
            }
            update(d);
        }

        function wrap(text, width) {
            text.each(function (d) {
                var text = d3.select(this),
                  
                  words = d.name.split(/\s+/).reverse(),
                  word,
                  line = [],
                  lineNumber = 0,
                  lineHeight = 1.1,
                  y = text.attr("y"),
                  dy = parseFloat(text.attr("dy")),
                  tspan = text.text(null).append("tspan").attr("x", 5).attr("y", y).attr("dy", dy + "em").attr('font-weight', 'bold').attr('fill','blue');
                while (word = words.pop()) {
                    line.push(word);
                    tspan.text(line.join(" "));
                    if (tspan.node().getComputedTextLength() > width) {
                        line.pop();
                        tspan.text(line.join(" "));
                        line = [word];
                        tspan = text.append("tspan").attr("x", 5).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                    }
                    
                    if(d.columns){
	                    d.columns.forEach(function(c,i){
	                    	dy = dy + 1;
	                    	tspan = text.append("tspan").attr("x", 5).attr("y", y).attr("dy", dy + "em").text(c.name);
	                    });
                    }
                }
                
                var textBox = text.node().getBBox();
                
                d.height = 19 * (lineNumber + 1);
                d3.select(this.parentNode.children[0]).attr('height', textBox.height);

            });
        }
	
	});
	</script>
	</svg>
</body>
</html>